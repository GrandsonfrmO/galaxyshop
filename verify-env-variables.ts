#!/usr/bin/env tsx\n/**\n * V√©rifier les Variables d'Environnement\n * Ex√©cuter: npx tsx verify-env-variables.ts\n */\n\nimport fs from 'fs';\nimport path from 'path';\n\ninterface EnvCheck {\n  variable: string;\n  status: 'ok' | 'placeholder' | 'missing' | 'invalid';\n  value: string;\n  message: string;\n}\n\nconst checks: EnvCheck[] = [];\n\nconsole.log('üîë V√âRIFICATION DES VARIABLES D\\'ENVIRONNEMENT\\n');\n\n// Lire .env.local\nconst envLocalPath = '.env.local';\nconst envLocal = fs.existsSync(envLocalPath) ? fs.readFileSync(envLocalPath, 'utf-8') : '';\n\nfunction parseEnv(content: string): Record<string, string> {\n  const env: Record<string, string> = {};\n  content.split('\\n').forEach(line => {\n    const [key, ...valueParts] = line.split('=');\n    if (key && key.trim() && !key.startsWith('#')) {\n      env[key.trim()] = valueParts.join('=').trim();\n    }\n  });\n  return env;\n}\n\nconst envVars = parseEnv(envLocal);\n\n// V√©rifier GEMINI_API_KEY\nconsole.log('üìã VARIABLES REQUISES');\nconsole.log('‚îÄ'.repeat(50));\n\nconst geminiKey = envVars.GEMINI_API_KEY || '';\nif (!geminiKey) {\n  checks.push({\n    variable: 'GEMINI_API_KEY',\n    status: 'missing',\n    value: '',\n    message: 'Non configur√©e'\n  });\n  console.log('‚ùå GEMINI_API_KEY: Non configur√©e');\n} else if (geminiKey === 'PLACEHOLDER_API_KEY' || geminiKey.includes('PLACEHOLDER')) {\n  checks.push({\n    variable: 'GEMINI_API_KEY',\n    status: 'placeholder',\n    value: geminiKey,\n    message: 'Placeholder (√† remplacer)'\n  });\n  console.log('‚ö†Ô∏è  GEMINI_API_KEY: Placeholder (√† remplacer)');\n} else if (geminiKey.startsWith('AIza')) {\n  checks.push({\n    variable: 'GEMINI_API_KEY',\n    status: 'ok',\n    value: geminiKey.substring(0, 10) + '...',\n    message: 'Configur√©e correctement'\n  });\n  console.log('‚úÖ GEMINI_API_KEY: Configur√©e correctement');\n} else {\n  checks.push({\n    variable: 'GEMINI_API_KEY',\n    status: 'invalid',\n    value: geminiKey,\n    message: 'Format invalide (doit commencer par AIza)'\n  });\n  console.log('‚ùå GEMINI_API_KEY: Format invalide');\n}\n\n// V√©rifier DATABASE_URL\nconst dbUrl = envVars.DATABASE_URL || '';\nif (!dbUrl) {\n  checks.push({\n    variable: 'DATABASE_URL',\n    status: 'missing',\n    value: '',\n    message: 'Non configur√©e'\n  });\n  console.log('‚ùå DATABASE_URL: Non configur√©e');\n} else if (dbUrl.includes('user:password') || dbUrl.includes('host.neon.tech/grandson_db')) {\n  checks.push({\n    variable: 'DATABASE_URL',\n    status: 'placeholder',\n    value: dbUrl.substring(0, 30) + '...',\n    message: 'Placeholder (√† remplacer)'\n  });\n  console.log('‚ö†Ô∏è  DATABASE_URL: Placeholder (√† remplacer)');\n} else if (dbUrl.startsWith('postgresql://')) {\n  checks.push({\n    variable: 'DATABASE_URL',\n    status: 'ok',\n    value: dbUrl.substring(0, 30) + '...',\n    message: 'Configur√©e correctement'\n  });\n  console.log('‚úÖ DATABASE_URL: Configur√©e correctement');\n} else {\n  checks.push({\n    variable: 'DATABASE_URL',\n    status: 'invalid',\n    value: dbUrl.substring(0, 30) + '...',\n    message: 'Format invalide (doit commencer par postgresql://)'\n  });\n  console.log('‚ùå DATABASE_URL: Format invalide');\n}\n\n// V√©rifier RESEND_API_KEY\nconst resendKey = envVars.RESEND_API_KEY || '';\nif (!resendKey) {\n  checks.push({\n    variable: 'RESEND_API_KEY',\n    status: 'missing',\n    value: '',\n    message: 'Non configur√©e'\n  });\n  console.log('‚ùå RESEND_API_KEY: Non configur√©e');\n} else if (resendKey === 'PLACEHOLDER_API_KEY' || resendKey.includes('PLACEHOLDER')) {\n  checks.push({\n    variable: 'RESEND_API_KEY',\n    status: 'placeholder',\n    value: resendKey,\n    message: 'Placeholder (√† remplacer)'\n  });\n  console.log('‚ö†Ô∏è  RESEND_API_KEY: Placeholder (√† remplacer)');\n} else if (resendKey.startsWith('re_')) {\n  checks.push({\n    variable: 'RESEND_API_KEY',\n    status: 'ok',\n    value: resendKey.substring(0, 10) + '...',\n    message: 'Configur√©e correctement'\n  });\n  console.log('‚úÖ RESEND_API_KEY: Configur√©e correctement');\n} else {\n  checks.push({\n    variable: 'RESEND_API_KEY',\n    status: 'invalid',\n    value: resendKey.substring(0, 10) + '...',\n    message: 'Format invalide (doit commencer par re_)'\n  });\n  console.log('‚ùå RESEND_API_KEY: Format invalide');\n}\n\nconsole.log('');\n\n// R√©sum√©\nconst ok = checks.filter(c => c.status === 'ok').length;\nconst placeholder = checks.filter(c => c.status === 'placeholder').length;\nconst missing = checks.filter(c => c.status === 'missing').length;\nconst invalid = checks.filter(c => c.status === 'invalid').length;\n\nconsole.log('üìä R√âSUM√â');\nconsole.log('‚îÄ'.repeat(50));\nconsole.log(`‚úÖ Configur√©es: ${ok}/3`);\nconsole.log(`‚ö†Ô∏è  Placeholders: ${placeholder}/3`);\nconsole.log(`‚ùå Manquantes: ${missing}/3`);\nconsole.log(`‚ùå Invalides: ${invalid}/3`);\nconsole.log('');\n\n// Verdict\nif (ok === 3) {\n  console.log('‚úÖ VERDICT: TOUTES LES VARIABLES SONT CONFIGUR√âES!');\n  console.log('');\n  console.log('Prochaines √©tapes:');\n  console.log('1. Tester localement: npm run dev:full');\n  console.log('2. Commiter: git add . && git commit -m \"Update env variables\"');\n  console.log('3. Pousser: git push origin main');\n  console.log('4. Ajouter dans Vercel Dashboard');\n  console.log('5. D√©ployer');\n  process.exit(0);\n} else if (placeholder > 0) {\n  console.log('‚ö†Ô∏è  VERDICT: PLACEHOLDERS √Ä REMPLACER');\n  console.log('');\n  console.log('√Ä faire:');\n  console.log('1. Obtenir les vraies cl√©s API');\n  console.log('2. Remplacer les placeholders dans .env.local');\n  console.log('3. Tester localement');\n  console.log('4. Commiter et pousser');\n  console.log('');\n  console.log('Voir: .kiro/ENVIRONMENT_VARIABLES_GUIDE.md');\n  process.exit(1);\n} else {\n  console.log('‚ùå VERDICT: VARIABLES MANQUANTES OU INVALIDES');\n  console.log('');\n  console.log('√Ä faire:');\n  console.log('1. V√©rifier .env.local');\n  console.log('2. Ajouter les variables manquantes');\n  console.log('3. Corriger les formats invalides');\n  console.log('');\n  console.log('Voir: .kiro/ENVIRONMENT_VARIABLES_GUIDE.md');\n  process.exit(1);\n}\n